#!/bin/bash

# Vérifier si un argument a été fourni
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <client_name>"
    exit 1
fi

CLIENT_NAME=$1
CONFIG_DIR="config"
OUTPUT_FILE="${CONFIG_DIR}/${CLIENT_NAME}.ovpn"

# Créer la configuration de base
cat > "$OUTPUT_FILE" << 'EOL'
client
dev tun
proto udp
remote 192.168.86.83 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
cipher AES-256-GCM
auth SHA256
key-direction 1
verb 3

<ca>
-----BEGIN CERTIFICATE-----
MIIDSzCCAjOgAwIBAgIUcR9YfFaUvGqV4h5FyAWb8fF+G2cwDQYJKoZIhvcNAQEL
BQAwFjEUMBIGA1UEAwwLRWFzeS1SU0EgQ0EwHhcNMjQwMTI1MjIzOTU1WhcNMzQw
MTIyMjIzOTU1WjAWMRQwEgYDVQQDDAtFYXN5LVJTQSBDQTCCASIwDQYJKoZIhvcN
AQEBBQADggEPADCCAQoCggEBANPFqxzxEFPxEEVEJzp5Ck0ZGFEPNgxjdBPr8Xr6
sBgUjkJsl9/5Kq5VWlHFGTnOvtYHBXxHvwv2qrPLwXQwQoNXu7Op+uBxnVqHZJgE
+yjRUK4jbO9OKjyHgAYqPqGAKj+hGvGM6GQECqTZJ5QO+EwQhQxPqjHuFvvQTFsY
Ey4sDvXTEBnhJ2HMBLWHOxBPGHQxoHpwQAMvPEO6OvFJVhxZbvbNvxYK+YxjRYEm
8QJTlJfuVQDQvNxcyAjxRdQFLDZf/+lzxKGBBOcBPQE7yJvGtRUBtVF1i7sVGWs/
OxQBBPLQXF6vMQBjvYeVvYQhHGpBxhQtFEBEGwpZwDMCAwEAAaOBkDCBjTAdBgNV
HQ4EFgQUTODPHxvXELUUt3+5jVjwwqaHxbAwUQYDVR0jBEowSIAUTODPHxvXELUU
t3+5jVjwwqaHxbChGqQYMBYxFDASBgNVBAMMC0Vhc3ktUlNBIENBghRxH1h8VpS8
apXiHkXIBZvx8X4bZzAMBgNVHRMEBTADAQH/MAsGA1UdDwQEAwIBBjANBgkqhkiG
9w0BAQsFAAOCAQEAyxNXyCM1XjBWrRNsZ2/RS8Q/PhTz/C5Gi1xHwFgwDQvNyxJP
kFjDpnFhUyDu3A+MEaKHYgQqUzQf+UXtzKsHLwRJAyKtYK+YuJqTyUQPjC7vgYBo
-----END CERTIFICATE-----
</ca>

<cert>
-----BEGIN CERTIFICATE-----
MIIDVDCCAjygAwIBAgIQILkrqBkp1LHOZsV6Tq3GvjANBgkqhkiG9w0BAQsFADAW
MRQwEgYDVQQDDAtFYXN5LVJTQSBDQTAeFw0yNDAxMjUyMjM5NTVaFw0zNDAxMjIy
MjM5NTVaMBYxFDASBgNVBAMMC0Vhc3ktUlNBIENBMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEA08WrHPEQU/EQRUQnOnkKTRkYUQ82DGN0E+vxevqwGBSO
QmyX3/kqrlVaUcUZOc6+1gcFfEe/C/aqs8vBdDBCg1e7s6n64HGdWodkmAT7KNFQ
riNs704qPIeABio+oYAqP6Ea8YzoZAQKpNknlA74TBCFDEyqMe4W+9BMWxgTLiwO
9dMQGeEnYcwEtYc7EE8YdDGgenBAAy88Q7o68UlWHFlu9s2/Fgr5jGNFgSbxAlOU
l+5VANC83FzICPFF1AUsNl//6XPEoYEE5wE9ATvIm8a1FQG1UXWLuxUZaz87FAEE
8tBcXq8xAGO9h5W9hCEcakHGFC0UQEQbClnAMwIDAQABo4GeMIGbMAkGA1UdEwQC
MAAwHQYDVR0OBBYEFEzgzx8b1xC1FLd/uY1Y8MKmh8WwMFEGA1UdIwRKMEiAFEzg
zx8b1xC1FLd/uY1Y8MKmh8WwoRqkGDAWMRQwEgYDVQQDDAtFYXN5LVJTQSBDQYIU
cR9YfFaUvGqV4h5FyAWb8fF+G2cwEwYDVR0lBAwwCgYIKwYBBQUHAwIwCwYDVR0P
BAQDAgeAMA0GCSqGSIb3DQEBCwUAA4IBAQBLvYX7fBVkPRKE4QYVj1yZvR9H8H9J
-----END CERTIFICATE-----
</cert>

<key>
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDTxasc8RBT8RBF
RCc6eQpNGRhRDzYMY3QT6/F6+rAYFI5CbJff+SquVVpRxRk5zr7WBwV8R78L9qqz
y8F0MEKDVruzqfrgcZ1ah2SYBPso0VCuI2zvTio8h4AGKj6hgCo/oRrxjOhkBAqk
2SeUDvhMEIUMTKox7hb70ExbGBMuLA710xAZ4SdhzAS1hzsQTxh0MaB6cEADLzxD
ujrxSVYcWW72zb8WCvmMY0WBJvECU5SX7lUA0LzcXMgI8UXUBSw2X//pc8ShgQTn
AT0BO8ibxrUVAbVRdYu7FRlrPzsUAQTy0FxerzEAY72Hlb2EIRxqQcYULRRAQBsK
WcAzAgMBAAECggEAJ6H+Vh+0n0TvB+WEhh9phBQjh6XJKcH/RWN+M8fGHb/YsEA8
m4TeB0W9HwPzh3ryKwlQJTk9plL+MeGXz9Llo9LfUxRX6nxA/RLVZ0aCXs5Qijb4
-----END PRIVATE KEY-----
</key>

<tls-auth>
-----BEGIN OpenVPN Static key V1-----
9bf9a8bc24c8871ca9263fded2b6c154
c8c14f9c19c3cccd75e4b24e8191fcc5
47b7c7aa3e5ce17a8e3d523d41e1a4f6
6f0dba9e3e6e2c5a1c8e4e49e7d1e3a2
d8c14f9c19c3cccd75e4b24e8191fcc5
3e5ce17a8e3d523d41e1a4f69bf9a8bc
24c8871ca9263fded2b6c154c8c14f9c
19c3cccd75e4b24e8191fcc547b7c7aa
3e5ce17a8e3d523d41e1a4f69bf9a8bc
24c8871ca9263fded2b6c154c8c14f9c
19c3cccd75e4b24e8191fcc547b7c7aa
3e5ce17a8e3d523d41e1a4f69bf9a8bc
24c8871ca9263fded2b6c154c8c14f9c
19c3cccd75e4b24e8191fcc547b7c7aa
3e5ce17a8e3d523d41e1a4f69bf9a8bc
24c8871ca9263fded2b6c154c8c14f9c
-----END OpenVPN Static key V1-----
</tls-auth>
EOL

# Rendre le fichier exécutable
chmod 600 "$OUTPUT_FILE"

echo "Configuration VPN générée dans $OUTPUT_FILE"
echo "Pour l'utiliser:"
echo "1. Copiez $OUTPUT_FILE sur votre machine"
echo "2. Installez OpenVPN"
echo "3. Lancez: openvpn --config $OUTPUT_FILE"
